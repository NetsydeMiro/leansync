{"version":3,"sources":["dist/leansync.js"],"names":["global","factory","exports","module","define","amd","self","leansync","this","findCorrespondingEntity","entities","entity","keySelector","find","serverEntity","assertNever","x","Error","isFunction","obj","toString","call","LeanSyncServer","[object Object]","config","clientEntities","lastSynced","Promise","async","resolve","reject","_a","_b","_c","_d","_e","_f","startTransaction","syncStamp","Date","handledKeys","syncResult","syncedEntities","newEntities","conflictedEntities","serverEntities","serverEntitiesUpdatedSinceLastSync","all","getServerEntities","map","entityKey","getServerEntitiesSyncedSince","clientEntity","conflictedServerEntity","areEntitiesEqual","push","conflictResolutionStrategy","updatedEntity","updateServerEntity","entityLastUpdated","createdEntity","createServerEntity","clientKey","commitTransaction","ex","rollBackTransaction","resolvedEntity","result","conflictedAgain","stillRequiringConflictResolution","ConnectivityError","LeanSyncClient","lastSync","getLastSyncStamp","getClientEntitiesRequiringSync","syncWithServer","processSyncResponse","newEntity","createEntity","modifiedEntity","updateEntity","conflictedEntity","markRequiringConflictResolution","markSyncStamp","Object","defineProperty","value"],"mappings":"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"}