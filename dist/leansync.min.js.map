{"version":3,"sources":["dist/leansync.js"],"names":["global","factory","exports","module","define","amd","self","leansync","this","findCorrespondingEntity","entities","entity","keySelector","find","serverEntity","assertNever","x","Error","isFunction","obj","toString","call","BASIC_CONFLICT_RESOLUTION_STRATEGIES","LeanSyncServer","[object Object]","config","clientEntities","lastSynced","Promise","async","resolve","reject","_a","_b","_c","_d","_e","_f","startTransaction","syncStamp","Date","handledKeys","syncResult","syncedEntities","newEntities","conflictedEntities","serverEntities","serverEntitiesUpdatedSinceLastSync","all","getServerEntities","map","entityKey","getServerEntitiesSyncedSince","clientEntity","conflictedServerEntity","areEntitiesEqual","push","conflictResolutionStrategy","updatedEntity","updateServerEntity","entityLastUpdated","createdEntity","createServerEntity","clientKey","commitTransaction","ex","rollBackTransaction","resolvedEntity","result","conflictedAgain","stillRequiringConflictResolution","ConnectivityError","LeanSyncClient","lastSync","getClientEntitiesRequiringSync","getLastSyncStamp","syncWithServer","processSyncResponse","newEntity","createEntity","modifiedEntity","updateEntity","conflictedEntity","markRequiringConflictResolution","markSyncStamp","Object","defineProperty","value"],"mappings":"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"}